<!---
@title  PostgreSQL数据库及入门
@category 开发手册 
@tag PostgreSQL
-->
<p>本教程是Fong在开发自己的<a href="http://www.fonlang.com/blog/">博客网站</a>时整理的，由于网站使用的AWS的Ubuntu套件， 所以，这里暂时只列举Ubuntu下的安装。</p>
<h2 id="ubuntu">Ubuntu下安装</h2>
<h3>安装客户端</h3>
<pre><code>sudo apt-get install postgresql-client</code></pre>
<h3>安装服务器</h3>
<pre><code>sudo apt-get install postgresql</code></pre>
<p>安装过程中，你会看到如下输出（每次安装过程你都应该关注这里输出，它给出了安装的一些关键信息）：</p>
<pre><code>Setting up libxslt1.1:amd64 (1.1.28-2.1ubuntu0.1) ...
Setting up ssl-cert (1.0.37) ...
Setting up postgresql-common (173) ...
Adding user postgres to group ssl-cert

Creating config file /etc/postgresql-common/createcluster.conf with new version

Creating config file /etc/logrotate.d/postgresql-common with new version
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
Removing obsolete dictionary files:
...
Setting up postgresql-9.5 (9.5.6-0ubuntu0.16.04) ...
Creating new cluster 9.5/main ...
  config /etc/postgresql/9.5/main
  data   /var/lib/postgresql/9.5/main
  locale en_US.UTF-8
  socket /var/run/postgresql
  port   5432
update-alternatives: using /usr/share/postgresql/9.5/man/man1/postmaster.1.gz to provide /usr/share/man/man1/postmaster.1.gz (postmaster.1.gz) in auto mode
Setting up postgresql (9.5+173) ...
Setting up postgresql-contrib-9.5 (9.5.6-0ubuntu0.16.04) ...
Setting up sysstat (11.2.0-1ubuntu0.1) ...

Creating config file /etc/default/sysstat with new version
update-alternatives: using /usr/bin/sar.sysstat to provide /usr/bin/sar (sar) in auto mode
Processing triggers for libc-bin (2.23-0ubuntu7) ...
Processing triggers for systemd (229-4ubuntu16) ...
Processing triggers for ureadahead (0.100.0-19) ...</code></pre>
<h3>新建数据库用户</h3>
<p>初次安装后，默认生成一个名为 postgres 数据库及名为 postgres 的数据库用户，同时还生成名为 postgres 的 Linux 系统用户，我们要通过这个 postgres 用户创建其他的用户及数据库。</p>
<p>创建系统用户 fonlang：</p>
<pre><code>ubuntu@localhost:~$ sudo adduser fonlang
Adding user `fonlang&#39; ...
Adding new group `fonlang&#39; (1001) ...
Adding new user `fonlang&#39; (1001) with group `fonlang&#39; ...
Creating home directory `/home/fonlang&#39; ...
Copying files from `/etc/skel&#39; ...</code></pre>
<p>切换到 postgres 用户，键入 psql 登录到数据库控制台：</p>
<pre><code>ubuntu@localhost:~$ sudo su - postgres
postgres@localhost:~$ psql
psql (9.5.6)
Type &quot;help&quot; for help.

postgres=#</code></pre>
<p>当然你也可以 <code>psql -h127.0.0.1 -Upostgres -p'yourpassword'</code>， 前提是你要知道 postgres 数据库用户的密码哦！</p>
<p>使用<code>\passwrd</code>命令修改 postgres 数据库用户的密码：</p>
<pre><code>postgres=# \password
Enter new password:
Enter it again:
postgres=#</code></pre>
<p>使用<code>CREATE USER</code>命令新建数据库用户：</p>
<pre><code>postgres=# CREATE USER fonlang WITH PASSWORD &#39;balabalab&#39;;
CREATE ROLE</code></pre>
<h3>允许远程访问</h3>
<p>打开配置文件 <code>/etc/postgresql/9.5/main/postgresql.conf</code>，修改 <code>listen_addresses</code>：</p>
<pre><code>vi /etc/postgresql/9.5/main/postgresql.conf
listen_addresses = &quot;*&quot;</code></pre>
<p>打开 <code>/etc/postgresql/9.3/main/pg_hba.conf</code>, 添加下面行以保证远程连接的任何用户可访问：</p>
<pre><code>host all all 192.169.3.0/24  md5
</code></pre>
<h3>创建数据库</h3>
<p>使用 <code>CREATE DATABASE</code> 命令新建数据库：</p>
<pre><code>postgres=# CREATE DATABASE fonlang_com OWNER fonlang;
CREATE DATABASE
postgres=#</code></pre>
<p>赋权限给指定用户（一定要所有权限都赋予用户，否则用户只能登录控制台，但没有任何数据库的权限）：</p>
<pre><code>postgres=# GRANT ALL PRIVILEGES ON DATABASE fonlang_com to fonlang;
GRANT</code></pre>
<p>退出</p>
<pre><code>postgres=# \q
</code></pre>
<h3>登录数据库</h3>
<p>ubuntu系统用户存在，但数据库用户不存在：</p>
<pre><code>ubuntu@localhost:~$ psql
psql: FATAL:  role &quot;ubuntu&quot; does not exist</code></pre>
<p>fonlang登录：</p>
<pre><code>psql -U fonlang -d fonlang_com -h 127.0.0.1 -p 5432</code></pre>
<h2>更多</h2>
<ul>
<li><a href="https://wiki.postgresql.org/wiki/Main_Page">PostgreSQL官方Wiki</a></li>
<li><a href="http://www.stuartellis.name/articles/postgresql-setup/">Using PostgreSQL on Debian and Ubuntu</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html">阮一峰 - PostgreSQL新手入门</a></li>
</ul>
